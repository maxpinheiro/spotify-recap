(this["webpackJsonpspotify-recap"]=this["webpackJsonpspotify-recap"]||[]).push([[0],{30:function(e,t,a){e.exports=a(76)},35:function(e,t,a){},76:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(25),o=a.n(s),c=a(12),i=a(3),u=(a(35),a(10)),l=a(2),m=a.n(l),h=a(9),p="ae520a706c27417f8b6b44bc41c224d0",f="2fecacd1974f4b9aacc3bafb76e8aeda",d="http://maxpinheiro.github.io/spotify-recap/#/spotifycallback",y="https://api.spotify.com/v1",g=function(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")};function v(){return(v=Object(h.a)(m.a.mark((function e(t){var a,n,r=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(r.length>1&&void 0!==r[1])||r[1],n=g({grant_type:"authorization_code",code:t,redirect_uri:a?"http://localhost:3000/#/callback":d}),e.abrupt("return",fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+window.btoa("".concat(p,":").concat(f))},body:n}).then((function(e){return e.json().then((function(e){return new Promise((function(t,a){e.hasOwnProperty("access_token")&&e.hasOwnProperty("refresh_token")&&e.hasOwnProperty("expires_in")?t({success:!0,accessToken:e.access_token,refreshToken:e.refresh_token,expiresIn:e.expires_in}):e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")?t({success:!1,errorMessage:e.error_description}):t({success:!1,errorMessage:"unknown error"})}))}))})).catch((function(e){return console.log("TOKEN ERROR: ",e),e.json()})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(h.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g({grant_type:"refresh_token",refresh_token:t}),e.abrupt("return",fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+window.btoa("".concat(p,":").concat(f))},body:a}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("access_token")&&e.hasOwnProperty("expires_in")?t({success:!0,accessToken:e.access_token,expiresIn:e.expires_in}):e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")?t({success:!1,errorMessage:e.error_description}):t({success:!1,errorMessage:"unknown error"})}))}))})).catch((function(e){return e.json()})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=Object(h.a)(m.a.mark((function e(t){var a,n,r=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:"artists",n=r.length>2&&void 0!==r[2]?r[2]:"medium_term",e.abrupt("return",fetch("".concat(y,"/me/top/").concat(a,"?time_range=").concat(n),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("items")?t({success:!0,items:e.items}):t({success:!1})}))}))})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=Object(h.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(y,"/me/player/currently-playing"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return 204===e.status?new Promise((function(e){return e({success:!1,playing:!1})})):e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("item")&&e.item.hasOwnProperty("name")&&e.item.hasOwnProperty("artists")?t({success:!0,song:e.item.name,artist:e.item.artists[0].name,spotifyId:e.item.id,albumArtUrl:e.item.album.images[0].url}):t({success:!1,errorMessage:"unknown error"})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(h.a)(m.a.mark((function e(t,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(y,"/audio-features/").concat(t),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("danceability")?t({success:!0,audioFeatures:{danceability:e.danceability,energy:e.energy,key:e.key,loudness:e.loudness,mode:e.mode,speechiness:e.speechiness,acousticness:e.acousticness,instrumentalness:e.instrumentalness,liveness:e.liveness,valence:e.valence,tempo:e.tempo,type:e.type,duration_ms:e.duration_ms,time_signature:e.time_signature}}):t({success:!1})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=Object(h.a)(m.a.mark((function e(t,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(y,"/audio-features/").concat(t),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("beats")?t({success:!0,beats:e.beats}):t({success:!1})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(h.a)(m.a.mark((function e(t,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(y,"/search?q=").concat(t,"&type=track&limit=10"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){if(e.hasOwnProperty("tracks")){var a=e.tracks.items;t({success:!0,songs:a.map((function(e){return{name:e.name,artist:(t=e.artists.map((function(e){return e.name})),t.join(", ")),spotifyId:e.id,spotifyUri:e.uri,imageUrl:e.album.images[0].url};var t}))})}else e.hasOwnProperty("error")?t({success:!1,errorMessage:e.message}):t({success:!1,errorMessage:"unknown error"})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j={getTokens:function(e){return v.apply(this,arguments)},refreshTokens:function(e){return w.apply(this,arguments)},getTopItems:function(e){return b.apply(this,arguments)},getCurrentTrack:function(e){return x.apply(this,arguments)},getAudioFeatures:function(e,t){return k.apply(this,arguments)},getAudioAnalysis:function(e,t){return E.apply(this,arguments)},searchSongs:function(e,t){return T.apply(this,arguments)}},O=a(26),_=a.n(O),P=function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}(10),N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#15d61c",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text-black",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:80,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80;return r.a.createElement("div",null,r.a.createElement("p",{className:"mb-3 ".concat(a)},e),r.a.createElement("div",{className:"flex"},r.a.createElement(_.a,{className:"mx-auto",type:"Oval",color:t,height:s,width:n})))},I=function(){var e=Object(n.useState)(!1),t=Object(u.a)(e,2),a=t[0],s=t[1];Object(n.useEffect)((function(){window.location.pathname.includes("spotifycallback")&&s(!0)}),[]);var o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||""===window.location.hostname;return console.log("Mode: ".concat(o?"development":"production")),a?r.a.createElement(i.a,{to:"/callback".concat(window.location.search)}):r.a.createElement("div",{className:"container mx-auto"},r.a.createElement("div",{style:{height:"25vh"}}),r.a.createElement("p",{className:"text-4xl font-semibold text-josephin my-4 text-center text-spotify-green"},"Spotify Recap"),r.a.createElement("div",{className:"py-5"}),r.a.createElement("div",{className:"flex"},r.a.createElement("a",{href:"https://accounts.spotify.com/authorize?client_id=".concat(p,"&response_type=code&redirect_uri=").concat(o?"http://localhost:3000%2F%23%2Fcallback":"http://maxpinheiro.github.io/spotify-recap%2F%23%2Fspotifycallback","&state=").concat(P,"&scope=").concat("user-top-read user-read-private user-read-currently-playing user-read-email","&show_dialog=").concat(!0),className:"rounded-lg p-4 bg-spotify-green text-xl text-josephin text-white mx-auto"},"Login through Spotify")),r.a.createElement("div",{style:{height:"50vh"}}))},M=a(8),S=a(13),A=a(14),C=a(15),z=a(17),R=a(16),D=function(e){var t=e.nameElement,a=e.imageUrl,n=e.link,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return r.a.createElement("div",{className:"d-flex flex-column mx-auto items-center mb-4 cursor-pointer"},r.a.createElement("a",{href:n},s&&r.a.createElement("img",{src:a,alt:"album cover",className:"mx-auto mb-1 rounded-full",style:{width:"60vw",height:"60vw",maxWidth:300,maxHeight:300}}),t))},U=function(e){var t=e.items,a=e.showImage,n=void 0===a||a;return r.a.createElement("div",null,t.map((function(e,t){var a,s;return r.a.createElement(D,{key:t,nameElement:r.a.createElement("p",{className:"text-white text-2xl"},e.name),imageUrl:(null===(a=e.images[0])||void 0===a?void 0:a.url)||"",link:(null===(s=e.external_urls)||void 0===s?void 0:s.spotify)||"",showImage:n})})))},B=function(e){var t=e.items,a=e.showImage,n=void 0===a||a;return r.a.createElement("div",null,t.map((function(e,t){var a,s,o,c;return r.a.createElement(D,{key:t,nameElement:r.a.createElement("div",null,r.a.createElement("p",{className:"text-white text-2xl"},e.name),r.a.createElement("p",{className:"text-white text-lg"},(null===(a=e.artists[0])||void 0===a?void 0:a.name)||"")),imageUrl:(null===(s=e.album)||void 0===s||null===(o=s.images[0])||void 0===o?void 0:o.url)||"",link:(null===(c=e.external_urls)||void 0===c?void 0:c.spotify)||"",showImage:n})})))},F={short_term:"last 4 weeks",medium_term:"last 6 months",long_term:"several years"},H=function(e){var t=e.topArtists,a=e.topTracks,s=Object(n.useState)("artists"),o=Object(u.a)(s,2),c=o[0],i=o[1],l=Object(n.useState)(""),m=Object(u.a)(l,2),h=m[0],p=m[1];return Object(n.useEffect)((function(){}),[]),r.a.createElement("div",{className:"flex flex-col text-josefin"},r.a.createElement("div",{className:"flex mx-auto"},r.a.createElement("p",{className:"text-white text-2xl mx-1"},"top"),["artists","tracks"].map((function(e){return r.a.createElement("p",{className:"text-white".concat(e===c?" cursor-pointer":"-disabled"," text-2xl mx-1"),onClick:function(){return i(e)}},e)}))),r.a.createElement("div",{className:"flex mx-auto my-2"},["short_term","medium_term","long_term"].map((function(e){return r.a.createElement("p",{className:"text-white".concat(e===h?"":"-disabled"," text-xl cursor-pointer mx-2"),onClick:function(){return p(e)}},F[e]||"")}))),r.a.createElement("div",{className:"border-b border-white w-1/2 mb-3 mt-1 mx-auto"}),"artists"===c&&r.a.createElement(U,{items:t[h]||[]}),"tracks"===c&&r.a.createElement(B,{items:a[h]||[]}))},L=a(23),J={status:"loading",accessToken:void 0,refreshToken:void 0,expiresIn:void 0,startTimeMs:void 0},q=function(e){Object(z.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state=J,n.refreshPlayer=n.refreshPlayer.bind(Object(C.a)(n)),n}return Object(A.a)(a,[{key:"componentDidMount",value:function(){var e=L.parse(this.props.location.search),t=e.accessToken,a=e.refreshToken,n=e.expiresIn,r=e.startTimeMs;t?(this.setState((function(e){return Object(M.a)(Object(M.a)({},e),{},{accessToken:t,refreshToken:a,expiresIn:n,startTimeMs:r})})),(Date.now()-r)/1e3>=n?this.refreshPlayer(a):this.getAllTopItems(t)):this.setState({status:"error",message:"The player failed to load for an unknown reason. Please refresh the page, or redirect to the home page to restart the authorization flow."})}},{key:"componentDidUpdate",value:function(e,t,a){var n=L.parse(this.props.location.search),r=n.accessToken,s=n.refreshToken,o=n.expiresIn,c=n.startTimeMs;c&&c!==t.startTimeMs&&this.setState((function(e){return Object(M.a)(Object(M.a)({},e),{},{accessToken:r,refreshToken:s,expiresIn:o,startTimeMs:c})}))}},{key:"refreshPlayer",value:function(){"blur(5px)"===document.body.style.backdropFilter&&(document.body.style.backgroundImage="",document.body.style.backdropFilter="",document.body.classList.add("bg-white")),this.setState((function(e){return Object(M.a)(Object(M.a)({},e),{},{status:"loading"})}));var e=(Date.now()-this.state.startTimeMs)/1e3,t=Math.ceil(this.state.expiresIn-e);console.log("Time left: ".concat(Math.floor(t/60),"m ").concat(t%60,"s | Expired: ").concat(t<=0)),t<=0&&this.refreshToken(this.state.spotifyRefreshToken)}},{key:"refreshToken",value:function(e){var t=this;j.refreshTokens(e).then((function(e){if(e.success){var a=e.accessToken,n=e.expiresIn;t.setState((function(e){return Object(M.a)(Object(M.a)({},e),{},{spotifyAccessToken:a,spotifyExpiresIn:n})})),t.props.history.push("/player?spotifyAccessToken=".concat(a,"&spotifyRefreshToken=").concat(t.state.spotifyRefreshToken,"&spotifyExpiresIn=").concat(n,"&startTimeMs=").concat(Date.now())),t.findCurrentSong(a)}else t.setState({status:"error",message:e.errorMessage||"idk why"})})).catch((function(e){t.setState({status:"error",message:"The player failed to load for an unknown reason. Please refresh the page, or redirect to the home page to restart the authorization flow."})}))}},{key:"getAllTopItems",value:function(){var e=Object(h.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={artists:{short_term:[],medium_term:[],long_term:[]},tracks:{short_term:[],medium_term:[],long_term:[]}},n=!0,["short_term","medium_term","long_term"].forEach(function(){var e=Object(h.a)(m.a.mark((function e(r){var s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getTopItems(t,"artists",r);case 2:return s=e.sent,e.next=5,j.getTopItems(t,"tracks",r);case 5:o=e.sent,s.success&&o.success?(a.artists[r]=s.items,a.tracks[r]=o.items):n=!1;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n?this.setState((function(e){return Object(M.a)(Object(M.a)({},e),{},{status:"success",allData:a})})):this.setState({status:"error"});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTopGenres",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={};return e.forEach((function(e){(e.genres||[]).forEach((function(e){e in t?t[e]+=1:t[e]=1}))})),t}},{key:"getTopItems",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"artists",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"medium_term";j.getTopItems(e,a,n).then((function(e){e.success?t.setState((function(t){return Object(M.a)(Object(M.a)({},t),{},{status:"success",items:e.items})})):t.setState({status:"error",message:"The recapper failed to load: ".concat(e.errorMessage||"idk why",". Please refresh the page, or redirect to the home page to restart the authorization flow.")})}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"container mx-auto text-center my-3 text-josephin"},"loading"===this.state.status&&r.a.createElement("div",null,r.a.createElement("div",{style:{height:"30vh"}}),N("Collecting your listening history...","#15d61c","text-white")),"success"===this.state.status&&this.state.allData&&r.a.createElement(H,{topArtists:this.state.allData.artists,topTracks:this.state.allData.tracks}),"error"===this.state.status&&r.a.createElement("span",null,r.a.createElement("p",{className:"mb-3 mx-2 text-white"},"There was an issue collecting data",this.state.message&&": ".concat(this.state.message),". Please login again through the home page."),r.a.createElement("div",{className:"flex"},r.a.createElement("a",{href:"/",className:"rounded bg-spotify-green text-white p-3 mx-auto"},"Home page"))))}}]),a}(r.a.Component),G=a(23),K=function(e){Object(z.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(S.a)(this,a),(n=t.call(this,e)).state={status:"loading",error:void 0,local:void 0},n}return Object(A.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=G.parse(this.props.location.search),a=t.code,n=t.error;a?setTimeout((function(){return e.getTokens(a)}),1e3):n&&this.setState({status:"error",error:n})}},{key:"getTokens",value:function(e){var t=this,a="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||""===window.location.hostname;j.getTokens(e,a).then((function(e){e.success?t.setState({status:"success",spotifyAccessToken:e.accessToken,spotifyRefreshToken:e.refreshToken,spotifyExpiresIn:e.expiresIn,local:a}):t.setState({status:"error",message:e.errorMessage})})).catch((function(e){t.setState({status:"error",message:e})}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"container mx-auto my-3 text-center text-josephin"},r.a.createElement("div",{style:{height:"30vh"}}),"loading"===this.state.status&&N("Logging you in...","#15d61c","text-white"),"success"===this.state.status&&r.a.createElement("div",{className:""},r.a.createElement(c.b,{to:"/recap?accessToken=".concat(this.state.spotifyAccessToken,"&refreshToken=").concat(this.state.spotifyRefreshToken,"&expiresIn=").concat(this.state.spotifyExpiresIn,"&startTimeMs=").concat(Date.now()),className:"rounded-lg p-4 bg-spotify-green text-xl text-josephin text-white mx-auto"},"Continue to Recap")),"error"===this.state.status&&r.a.createElement("span",null,r.a.createElement("p",{className:"mb-3 mx-2 text-white"},"There was an issue logging in",this.state.message&&": ".concat(this.state.message),". Please login again through the home page."),r.a.createElement("div",{className:"flex"},r.a.createElement("a",{href:"/",className:"rounded bg-spotify-green text-white p-3 mx-auto"},"Home page"))),r.a.createElement("div",{style:{height:"50vh"}}))}}]),a}(r.a.Component),W=a(29),Q=a.n(W),V=function(){var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],s=t[1];return Object(n.useEffect)((function(){if(window.location.hash.includes("callback")&&window.location.search){var e=Q.a.parse(window.location.search.substring(1)).code;e&&s(e)}}),[]),r.a.createElement("div",{className:"text-center"},r.a.createElement("div",{style:{height:"30vh"}}),a&&r.a.createElement(i.a,{to:"/callback?code=".concat(a)}),r.a.createElement("div",{style:{height:"70vh"}}))};o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement("div",{className:""},r.a.createElement(c.a,null,r.a.createElement("div",{className:"flex flex-row"},r.a.createElement("a",{href:"/"},r.a.createElement("p",{className:"text-white m-3"},"Home"))),r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/",component:I}),r.a.createElement(i.b,{path:"/callback",component:K}),r.a.createElement(i.b,{path:"/recap",component:q}),r.a.createElement(i.b,{component:V}))))),document.getElementById("root"))}},[[30,1,2]]]);
//# sourceMappingURL=main.aa2a2c1d.chunk.js.map