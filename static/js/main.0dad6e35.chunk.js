(this["webpackJsonpspotify-recap"]=this["webpackJsonpspotify-recap"]||[]).push([[0],{29:function(e,t,n){e.exports=n(73)},34:function(e,t,n){},73:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(24),o=n.n(r),c=n(15),i=n(3),u=(n(34),n(28)),p=n(2),l=n.n(p),h=n(8),m="ae520a706c27417f8b6b44bc41c224d0",f="2fecacd1974f4b9aacc3bafb76e8aeda",d=function(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")};function y(){return(y=Object(h.a)(l.a.mark((function e(t){var n,a,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(s.length>1&&void 0!==s[1])||s[1],a=d({grant_type:"authorization_code",code:t,redirect_uri:n?"http://localhost:3000/spotifycallback":"http://maxpinheiro.github.io/spotify-lyrics/#/spotifycallback"}),e.abrupt("return",fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+window.btoa("".concat(m,":").concat(f))},body:a}).then((function(e){return e.json().then((function(e){return new Promise((function(t,n){e.hasOwnProperty("access_token")&&e.hasOwnProperty("refresh_token")&&e.hasOwnProperty("expires_in")?t({success:!0,accessToken:e.access_token,refreshToken:e.refresh_token,expiresIn:e.expires_in}):e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")?t({success:!1,errorMessage:e.error_description}):t({success:!1,errorMessage:"unknown error"})}))}))})).catch((function(e){return console.log("TOKEN ERROR: ",e),e.json()})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=Object(h.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d({grant_type:"refresh_token",refresh_token:t}),e.abrupt("return",fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+window.btoa("".concat(m,":").concat(f))},body:n}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("access_token")&&e.hasOwnProperty("expires_in")?t({success:!0,accessToken:e.access_token,expiresIn:e.expires_in}):e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")?t({success:!1,errorMessage:e.error_description}):t({success:!1,errorMessage:"unknown error"})}))}))})).catch((function(e){return e.json()})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(h.a)(l.a.mark((function e(t){var n,a,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:"artists",a=s.length>2&&void 0!==s[2]?s[2]:"medium_term",e.abrupt("return",fetch("https://api.spotify.com/v1/me/top/".concat(n,"?time_range=").concat(a),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("items")?t({success:!0,items:e.items}):t({success:!1})}))}))})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=Object(h.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/me/player/currently-playing",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return 204===e.status?new Promise((function(e){return e({success:!1,playing:!1})})):e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("item")&&e.item.hasOwnProperty("name")&&e.item.hasOwnProperty("artists")?t({success:!0,song:e.item.name,artist:e.item.artists[0].name,spotifyId:e.item.id,albumArtUrl:e.item.album.images[0].url}):t({success:!1,errorMessage:"unknown error"})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=Object(h.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/audio-features/".concat(t),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("danceability")?t({success:!0,audioFeatures:{danceability:e.danceability,energy:e.energy,key:e.key,loudness:e.loudness,mode:e.mode,speechiness:e.speechiness,acousticness:e.acousticness,instrumentalness:e.instrumentalness,liveness:e.liveness,valence:e.valence,tempo:e.tempo,type:e.type,duration_ms:e.duration_ms,time_signature:e.time_signature}}):t({success:!1})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(h.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/audio-features/".concat(t),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){e.hasOwnProperty("beats")?t({success:!0,beats:e.beats}):t({success:!1})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=Object(h.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/search?q=".concat(t,"&type=track&limit=10"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}).then((function(e){return e.json().then((function(e){return new Promise((function(t){if(e.hasOwnProperty("tracks")){var n=e.tracks.items;t({success:!0,songs:n.map((function(e){return{name:e.name,artist:(t=e.artists.map((function(e){return e.name})),t.join(", ")),spotifyId:e.id,spotifyUri:e.uri,imageUrl:e.album.images[0].url};var t}))})}else e.hasOwnProperty("error")?t({success:!1,errorMessage:e.message}):t({success:!1,errorMessage:"unknown error"})}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(h.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/me/player/pause",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return 204===e.status?new Promise((function(e){return e({success:!0})})):404===e.status?new Promise((function(e){return e({success:!1,message:"no device found"})})):403===e.status?new Promise((function(e){return e({success:!1,message:"user making request is non-premium"})})):new Promise((function(e){return e({success:!1,message:"unknown error"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return(j=Object(h.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/me/player/next",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return 204===e.status?new Promise((function(e){return e({success:!0})})):404===e.status?new Promise((function(e){return e({success:!1,message:"no device found"})})):403===e.status?new Promise((function(e){return e({success:!1,message:"user making request is non-premium"})})):new Promise((function(e){return e({success:!1,message:"unknown error"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(h.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://api.spotify.com/v1/me/player/queue?uri=".concat(t),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}).then((function(e){return 204===e.status?new Promise((function(e){return e({success:!0})})):404===e.status?new Promise((function(e){return e({success:!1,message:"no device found"})})):403===e.status?new Promise((function(e){return e({success:!1,message:"user making request is non-premium"})})):new Promise((function(e){return e({success:!1,message:"unknown error"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E={getTokens:function(e){return y.apply(this,arguments)},refreshTokens:function(e){return g.apply(this,arguments)},getTopItems:function(e){return w.apply(this,arguments)},getCurrentTrack:function(e){return v.apply(this,arguments)},getAudioFeatures:function(e,t){return b.apply(this,arguments)},getAudioAnalysis:function(e,t){return k.apply(this,arguments)},searchSongs:function(e,t){return x.apply(this,arguments)},pausePlayback:function(e){return T.apply(this,arguments)},skipPlayback:function(e){return j.apply(this,arguments)},addToQueue:function(e,t){return O.apply(this,arguments)}},P=n(25),_=n.n(P),M=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(10),N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#15d61c",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text-black",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:80,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80;return s.a.createElement("div",null,s.a.createElement("p",{className:"mb-3 ".concat(n)},e),s.a.createElement("div",{className:"flex"},s.a.createElement(_.a,{className:"mx-auto",type:"Oval",color:t,height:r,width:a})))},I=function(){var e=Object(a.useState)(!1),t=Object(u.a)(e,2),n=t[0],r=t[1];Object(a.useEffect)((function(){window.location.pathname.includes("spotifycallback")&&r(!0)}),[]);var o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||""===window.location.hostname;return console.log("Mode: ".concat(o?"development":"production")),n?s.a.createElement(i.a,{to:"/spotify-lyrics#/spotifycallback".concat(window.location.search)}):s.a.createElement("div",{className:"container mx-auto"},s.a.createElement("div",{style:{height:"25vh"}}),s.a.createElement("p",{className:"text-4xl font-semibold text-josephin my-4 text-center text-spotify-green"},"Spotify Recap"),s.a.createElement("div",{className:"py-5"}),s.a.createElement("div",{className:"flex"},s.a.createElement("a",{href:"https://accounts.spotify.com/authorize?client_id=".concat(m,"&response_type=code&redirect_uri=").concat(o?"http://localhost:3000/spotifycallback":"http://maxpinheiro.github.io/spotify-recap/%23/spotifycallback","&state=").concat(M,"&scope=").concat("user-top-read user-read-private user-read-currently-playing user-read-email","&show_dialog=").concat(!0),className:"rounded-lg p-4 bg-spotify-green text-xl text-josephin text-white mx-auto"},"Login through Spotify")),s.a.createElement("div",{style:{height:"50vh"}}))},S=n(9),C=n(11),A=n(12),z=n(16),R=n(14),B=n(13),D=function(e){var t=e.items,n=e.type;return s.a.createElement("div",{className:"flex flex-col text-josefin"},s.a.createElement("p",{className:"text-white text-2xl"},"top ",n),s.a.createElement("div",{className:"border-b border-white w-1/6 mb-3 mt-1 mx-auto"}),"artists"===n&&t.map((function(e,t){var n;return s.a.createElement("div",{key:t},s.a.createElement("a",{href:(null===(n=e.external_urls)||void 0===n?void 0:n.spotify)||"",className:"text-white"},e.name))})))},U=n(22),q={status:"loading",accessToken:void 0,refreshToken:void 0,expiresIn:void 0,startTimeMs:void 0},F=function(e){Object(R.a)(n,e);var t=Object(B.a)(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e)).state=q,a.refreshPlayer=a.refreshPlayer.bind(Object(z.a)(a)),a}return Object(A.a)(n,[{key:"componentDidMount",value:function(){var e=U.parse(this.props.location.search),t=e.accessToken,n=e.refreshToken,a=e.expiresIn,s=e.startTimeMs;t?(this.setState((function(e){return Object(S.a)(Object(S.a)({},e),{},{accessToken:t,refreshToken:n,expiresIn:a,startTimeMs:s})})),(Date.now()-s)/1e3>=a?this.refreshPlayer(n):(console.log(t),this.getTopItems(t))):this.setState({status:"error",message:"The player failed to load for an unknown reason. Please refresh the page, or redirect to the home page to restart the authorization flow."})}},{key:"componentDidUpdate",value:function(e,t,n){var a=U.parse(this.props.location.search),s=a.accessToken,r=a.refreshToken,o=a.expiresIn,c=a.startTimeMs;c&&c!==t.startTimeMs&&this.setState((function(e){return Object(S.a)(Object(S.a)({},e),{},{accessToken:s,refreshToken:r,expiresIn:o,startTimeMs:c})}))}},{key:"refreshPlayer",value:function(){"blur(5px)"===document.body.style.backdropFilter&&(document.body.style.backgroundImage="",document.body.style.backdropFilter="",document.body.classList.add("bg-white")),this.setState((function(e){return Object(S.a)(Object(S.a)({},e),{},{status:"loading"})}));var e=(Date.now()-this.state.startTimeMs)/1e3,t=Math.ceil(this.state.expiresIn-e);console.log("Time left: ".concat(Math.floor(t/60),"m ").concat(t%60,"s | Expired: ").concat(t<=0)),t<=0&&this.refreshToken(this.state.spotifyRefreshToken)}},{key:"refreshToken",value:function(e){var t=this;E.refreshTokens(e).then((function(e){if(e.success){var n=e.accessToken,a=e.expiresIn;t.setState((function(e){return Object(S.a)(Object(S.a)({},e),{},{spotifyAccessToken:n,spotifyExpiresIn:a})})),t.props.history.push("/player?spotifyAccessToken=".concat(n,"&spotifyRefreshToken=").concat(t.state.spotifyRefreshToken,"&spotifyExpiresIn=").concat(a,"&startTimeMs=").concat(Date.now())),t.findCurrentSong(n)}else t.setState({status:"error",message:"The recapper failed to load: ".concat(e.errorMessage||"idk why",". Please refresh the page, or redirect to the home page to restart the authorization flow.")})})).catch((function(e){t.setState({status:"error",message:"The player failed to load for an unknown reason. Please refresh the page, or redirect to the home page to restart the authorization flow."})}))}},{key:"getTopItems",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"artists",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"medium_term";E.getTopItems(e,n,a).then((function(e){e.success?t.setState((function(t){return Object(S.a)(Object(S.a)({},t),{},{status:"success",items:e.items})})):t.setState({status:"error",message:"The recapper failed to load: ".concat(e.errorMessage||"idk why",". Please refresh the page, or redirect to the home page to restart the authorization flow.")})}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"container mx-auto text-center my-3 text-josephin"},"loading"===this.state.status&&s.a.createElement("div",null,s.a.createElement("div",{style:{height:"30vh"}}),N("Collecting your listening history...","#15d61c","text-white")),"success"===this.state.status&&s.a.createElement(D,{items:this.state.items,type:"artists"}),"error"===this.state.status&&s.a.createElement("span",null,s.a.createElement("p",{className:"mb-3 mx-2 text-white"},"There was an issue collecting data",this.state.message&&": ".concat(this.state.message),". Please login again through the home page."),s.a.createElement("div",{className:"flex"},s.a.createElement("a",{href:"/",className:"rounded bg-spotify-green text-white p-3 mx-auto"},"Home page"))))}}]),n}(s.a.Component),H=n(22),L=function(e){Object(R.a)(n,e);var t=Object(B.a)(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e)).state={status:"loading",error:void 0,local:void 0},a}return Object(A.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=H.parse(this.props.location.search),n=t.code,a=t.error;n?setTimeout((function(){return e.getTokens(n)}),1e3):a&&this.setState({status:"error",error:a})}},{key:"getTokens",value:function(e){var t=this,n="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||""===window.location.hostname;E.getTokens(e,n).then((function(e){e.success?t.setState({status:"success",spotifyAccessToken:e.accessToken,spotifyRefreshToken:e.refreshToken,spotifyExpiresIn:e.expiresIn,local:n}):t.setState({status:"error",message:e.errorMessage})})).catch((function(e){t.setState({status:"error",message:e})}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"container mx-auto my-3 text-center text-josephin"},s.a.createElement("div",{style:{height:"30vh"}}),"loading"===this.state.status&&N("Logging you in...","#15d61c","text-white"),"success"===this.state.status&&s.a.createElement("div",{className:""},s.a.createElement("a",{href:"/#/recap?accessToken=".concat(this.state.spotifyAccessToken,"&refreshToken=").concat(this.state.spotifyRefreshToken,"&expiresIn=").concat(this.state.spotifyExpiresIn,"&startTimeMs=").concat(Date.now()),className:"rounded-lg p-4 bg-spotify-green text-xl text-josephin text-white mx-auto"},"Continue to Recap")),"error"===this.state.status&&s.a.createElement("span",null,s.a.createElement("p",{className:"mb-3 mx-2 text-white"},"There was an issue logging in",this.state.message&&": ".concat(this.state.message),". Please login again through the home page."),s.a.createElement("div",{className:"flex"},s.a.createElement("a",{href:"/",className:"rounded bg-spotify-green text-white p-3 mx-auto"},"Home page"))),s.a.createElement("div",{style:{height:"50vh"}}))}}]),n}(s.a.Component),J=function(e){Object(R.a)(n,e);var t=Object(B.a)(n);function n(e){var a;return Object(C.a)(this,n),(a=t.call(this,e)).state={spotifyCallback:!1,code:null},a}return Object(A.a)(n,[{key:"componentDidMount",value:function(){console.log(window.location),window.location.hash.includes("spotifycallback")&&this.setState({spotifyCallback:!0,query:window.location.search})}},{key:"componentDidUpdate",value:function(e,t,n){}},{key:"render",value:function(){return s.a.createElement("div",{className:"text-center"},s.a.createElement("div",{style:{height:"30vh"}}),this.state.spotifyCallback&&s.a.createElement(i.a,{to:"/callback".concat(this.state.query)}),s.a.createElement("div",{style:{height:"70vh"}}))}}]),n}(s.a.Component);o.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement("div",{className:""},s.a.createElement(c.a,null,s.a.createElement("div",{className:"flex flex-row"},s.a.createElement("a",{href:"/"},s.a.createElement("p",{className:"text-white m-3"},"Home"))),s.a.createElement(i.d,null,s.a.createElement(i.b,{exact:!0,path:"/",component:I}),s.a.createElement(i.b,{path:"/callback",component:L}),s.a.createElement(i.b,{path:"/recap",component:F}),s.a.createElement(i.b,{component:J}))))),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.0dad6e35.chunk.js.map